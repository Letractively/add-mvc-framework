#summary ADD MVC Models
#labels Phase-Design

= Introduction =
  on ADD MVC, model classes represents table of the database.

  for each table on the database you want to manipulate, you will have to create a model for it.

  ADD Framework's models uses adodb abstraction layer, or you can also wrap it first, as long as the adodb methods are callable (e.g. GetArray(), SelectLimit() etc.)


== Model Names ==

   the class names of models is not restricted, but as a good practice, use the singular form of the table names (eg. member for ``members`` table)


== Basic Code ==

{{{
CLASS company EXTENDS model_rwd {
   /**
    * The table
    */
   const TABLE = 'company';
   /**
    * The table's primary key
    */
   const TABLE_PK = 'company_id';
   /**
    * The ADODB object
    *
    */
   public function db() {
     return my_application_adodb::singleton();
   }
}
}}}

Where: const TABLE is the table of the company and TABLE_PK is the primary key field and db() is the adodb object

== Basic Functions ==
  * insertion
    * `company::add_new(array $row)` - inserts a new row and returns the new instance
  * selections
    * `company::get_instance(mixed $id)` - gets the row with primary key $id
    * `company::get_where_order_page(mixed $where, string $order_by, int $page, int $per_page)` - returns array of instances of the model according to the parameters given
  * updates
    * `$company->company_name="New Company Name" `
      assign a new value on the object property and it will updated on script shutdown
  * delete
    * `$company->delete()`

== Abstract Model Classes ==
  * [http://mvc.add.ph/docs/classes/model_rwd.html model_rwd] - Read Write Delete Model
  * [http://mvc.add.ph/docs/classes/model_r.html model_r] - Read Only Model
  * [http://mvc.add.ph/docs/classes/model_auth.html model_auth] - For model that are meant for tables of users that logs in. or any entity that is authenticated
     * Note: Check the constants before using this class.
  * [http://mvc.add.ph/docs/classes/model_image_rwd.html model_image_rwd ] For having a filesystem image with 1:1 related database row

=== model_auth example ===
{{{
<?php

/**
 * admin model
 *
 */
CLASS admin EXTENDS model_auth {
   const TABLE = 'view_admins';

   const USERNAME_FIELD = 'email';

   const SESSION_KEY = 'add.ph_admin';

   const LOGIN_PAGE = 'admin/login';

   /**
    * The ADODB Object
    *
    * @since ADD.PH 2.0
    */
   public static function db() {
      return adodb_addph::singleton();
   }

}
}}}

== Tips ==
 * Table related methods should be static context while row related functions are object.
 * Model names should be singular, (e.g. member::get_instance())
 * Methods that will return array of instances should be plural ( e.g. $member->transactions() )
 * Methods that will get foreign instances should have the same name (plural form) as it's model (e.g. $member->vehicles() // Where vehicle is a model related to member)


== Function List ==
 * Maybe it's better to look at the phpdoc included in the framework *
 === model_rwd::db() ===
   returns the adodb object. To set this, extend this inside the concrete model class so you can return your own value. (There is no default)
 === $model_rwd->update_db_row() ===
   updates the updated fields of the row (instead of waiting for script shutdown)
 === model_rwd::instances_from_sql() ===
  gets all the instances from the select sql

*Parameters*
 * $sql_format (required) - must contain 2 %s, the first is for to be replaced with "`*`" and the table name of the model class.
 * $page - page number to fetch ($per_page required)
 * $per_page - number of rows per page
{{{
   $company = company::instances_from_sql("SELECT %s FROM %s WHERE category='1'");
}}}
note: you have to use %% for % when using this function (eg. `LIKE '%%foo%%'`)
 === model_rwd::get_where_order_page() ===
   Centralized select query
*Parameters*
 * mixed $conditions array or string of conditions
 * string $order_by string to use as order by (default: none)
 * int $page for limit clause (default: gets all)
 * int $per_page number of items per page for limit clause (default: 10 per page)
{{{
# gets the page 2 (20 per page) of all row instances where category is equal to 1
$companies = company::get_where_order_page(array('category' => '1'),2,20);
}}}

 === model_rwd::get_count() ===
   get the count of rows
* Parameters *
 * mixed $conditions - conditions (where)

 === model_rwd::get_page_instances() ===
   get all instance from static::TABLE matching ALL $conditions , with pagination of page 1, 10 rows/page

 * int $page to fetch
 * order by clause
 * mixed $conditions the where clause conditions
 * int $per_page instance count per page