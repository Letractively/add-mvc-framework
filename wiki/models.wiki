#summary ADD MVC Models
#labels Phase-Design

= Introduction =
  on ADD MVC, model classes represents table of the database.

  for each table on the database you want to manipulate, you will have to create a model for it.


== Model Names ==

   the class names of models is not restricted, but as a good practice, use the singular form of the table names (eg. member for ``members`` table)


== Basic Code ==

{{{
CLASS company EXTENDS model_rwd {
   /**
    * The table
    */
   const TABLE = 'company';
   /**
    * The table's primary key
    */
   const TABLE_PK = 'company_id';
   /**
    * The ADODB object 
    *
    */
   public function db() {
     return my_application_adodb::singleton();
   }
}
}}}

Where: const TABLE is the table of the company and TABLE_PK is the primary key field and db() is the adodb object

== Basic Functions ==
  * insertion
    * `company::add_new(array $row)` - inserts a new row and returns the new instance
  * selections
    * `company::get_instance(mixed $id)` - gets the row with primary key $id
    * `company::get_where_order_page(mixed $where, string $order_by, int $page, int $per_page)` - returns array of instances of the model according to the parameters given
  * updates
    * `$company->company_name="New Company Name" `
      assign a new value on the object property and it will updated on script shutdown
  * delete
    * `$company->delete()`

== Function List ==
 === model_rwd::db() ===
   returns the adodb object. To set this, extend this inside the concrete model class so you can return your own value. (There is no default)
 === $model_rwd->update_db_row() ===
   updates the updated fields of the row (instead of waiting for script shutdown)
 === model_rwd::instances_from_sql() === 
  gets all the instances from the select sql
  
*Parameters*
 * $sql_format (required) - must contain 2 %s, the first is for to be replaced with "`*`" and the table name of the model class.
 * $page - page number to fetch ($per_page required)
 * $per_page - number of rows per page
{{{
   $company = company::instances_from_sql("SELECT %s FROM %s WHERE category='1'");
}}}
note: you have to use %% for % when using this function (eg. `LIKE '%%foo%%'`)
 === model_rwd::get_where_order_page() === 
   Centralized select query
*Parameters*
 * mixed $conditions array or string of conditions
 * string $order_by string to use as order by (default: none)
 * int $page for limit clause (default: gets all)
 * int $per_page number of items per page for limit clause (default: 10 per page)
{{{
# gets the page 2 (20 per page) of all row instances where category is equal to 1
$companies = company::get_where_order_page(array('category' => '1'),2,20);
}}}